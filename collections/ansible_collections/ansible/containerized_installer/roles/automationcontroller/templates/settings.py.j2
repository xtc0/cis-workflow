# !!! DO NOT EDIT THIS FILE !!!
# Default AWX settings

###############################################################################
# MISC PROJECT SETTINGS
###############################################################################

ADMINS = (
   #('Joe Admin', 'joeadmin@example.com'),
)

STATIC_ROOT = '/var/lib/awx/public/static'

PROJECTS_ROOT = '{{ controller_data_dir }}/projects'

JOBOUTPUT_ROOT = '/var/lib/awx/job_status'

AWX_ISOLATION_BASE_PATH = '{{ controller_data_dir }}/job_execution'

DEFAULT_CONTAINER_RUN_OPTIONS = ["--network", "slirp4netns:enable_ipv6=true", "--security-opt", "label={{ controller_container_label }}"]

SECRET_KEY = open('/etc/tower/SECRET_KEY', 'rb').read().strip()

ALLOWED_HOSTS = ['*']

SYSTEM_UUID = '{{ ansible_product_uuid | lower }}'

{% if controller_nginx_disable_https | bool %}
CSRF_COOKIE_SECURE = False

SESSION_COOKIE_SECURE = False
{% endif %}

{% if controller_nginx_disable_https | bool %}
BROADCAST_WEBSOCKET_PORT = {{ controller_nginx_http_port }}
BROADCAST_WEBSOCKET_PROTOCOL = 'http'
{% else %}
BROADCAST_WEBSOCKET_PORT = {{ controller_nginx_https_port }}
{% endif %}

# This setting adjusts the amount of memory that Controller
# considers available for determining its capacity.
# When colocating with other services, such as the gateway or the databse,
# it is advised to set controller_percent_memory_capacity to less than 1.0
# to throttle how many jobs controller will attempt to control/execute on this node
SYSTEM_TASK_ABS_MEM =  "{{ (ansible_memtotal_mb * controller_percent_memory_capacity) | round | int  }}Mi"

###############################################################################
# EMAIL SETTINGS
###############################################################################

SERVER_EMAIL = 'root@localhost'
DEFAULT_FROM_EMAIL = 'webmaster@localhost'
EMAIL_SUBJECT_PREFIX = '[AWX] '

EMAIL_HOST = 'localhost'
EMAIL_PORT = 25
EMAIL_HOST_USER = ''
EMAIL_HOST_PASSWORD = ''
EMAIL_USE_TLS = False

# AAP Gateway settings
ALLOW_LOCAL_RESOURCE_MANAGEMENT = False
ANSIBLE_BASE_JWT_KEY = '{{ hostvars[groups["automationgateway"][0]]["_gateway_proxy_url"] }}'
ANSIBLE_BASE_JWT_REDIRECT_TYPE= "awx"
ANSIBLE_BASE_MANAGED_ROLE_REGISTRY = {'platform_auditor': {'name': 'Platform Auditor', 'shortname': 'sys_auditor'}}
REMOTE_HOST_HEADERS = ['HTTP_X_FORWARDED_FOR', 'REMOTE_ADDR', 'REMOTE_HOST']

# Update URL prefix when gateway deployed so internal links work correctly
OPTIONAL_API_URLPATTERN_PREFIX = "controller"
OPTIONAL_UI_URL_PREFIX = "execution"

# If loading from an https URL do we calidate the cert?
ANSIBLE_BASE_JWT_VALIDATE_CERT = True

# Add warning logger for aap (all of gateway is under aap.gateway)
LOGGING['loggers']['aap'] = {'handlers': ['console', 'file', 'tower_warnings', 'external_logger'], 'level': 'WARNING'}
LOGGING['loggers']['ansible_base'] = {'handlers': ['console', 'file', 'tower_warnings', 'external_logger'], 'level': 'WARNING'}

{% for item in controller_extra_settings %}
{% if item.value is string %}
{{ item.setting }} = '{{ item.value }}'
{% else %}
{{ item.setting }} = {{ item.value }}
{% endif %}
{% endfor %}

# Feature flags
{% if feature_flags is defined %}
{% for flag_name, flag_value in feature_flags.items() %}
{{ flag_name | upper }} = {{ flag_value | bool }}
{% endfor %}
{% endif %}

###############################################################################
#
# !!!!!!!!!!!! DO NOT EDIT THIS FILE !!!!!!!!!!!
#
# This file *will* be overwritten the next time you upgrade, and any
# changes you make here *will* be lost.
#
# Many setting values can be persisted to the database by visiting:
#
# https://your-ansible-platform.example.org/api/v2/settings/all/
#
# Custom settings you wish to persist must be set with controller_extra_settings
#
###############################################################################
